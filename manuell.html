<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abholzeiten Admin</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body { font-family:sans-serif; margin:0; padding:20px; background:#f4f4f4; }
    .container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); margin-bottom:20px; }
    h1,h2 { text-align:center; }
    input,select,button { width:100%; padding:10px; margin:8px 0; border-radius:4px; border:1px solid #ccc; box-sizing:border-box; }
    button { background:#4CAF50; color:#fff; border:none; cursor:pointer; }
    button:hover { background:#45a049; }
    #status { text-align:center; font-style:italic; margin-top:10px; }
  </style>
</head>
<body>

  <h1>Abholzeiten Admin</h1>

  <div class="container">
    <h2>Einmalige Abholzeit setzen</h2>
    <select id="onetime-child"></select>
    <input type="date" id="onetime-date">
    <input type="time" id="onetime-time">
    <button onclick="saveOnetime()">Speichern</button>
  </div>

  <div class="container">
    <h2>Kind hinzufügen</h2>
    <input type="text" id="new-child" placeholder="Name des Kindes">
    <button onclick="addChild()">Hinzufügen</button>
  </div>

  <div class="container">
    <h2>Basis-Abholzeit ändern</h2>
    <select id="base-child"></select>
    <select id="base-day"></select>
    <input type="time" id="base-time">
    <button onclick="saveBase()">Speichern</button>
  </div>

  <div class="container">
    <h2>Kinder löschen</h2>
    <select id="delete-child"></select>
    <button onclick="deleteChild()">Löschen</button>
  </div>

  <div id="status"></div>

<script>
  const firebaseConfig = {
    apiKey:"AIzaSyA9TnOd0oTD0tTNEqMi_7PHU-p0av-XjM0",
    databaseURL:"https://abab-58a5f-default-rtdb.europe-west1.firebasedatabase.app"
  };
  firebase.initializeApp(firebaseConfig);
  const db=firebase.database();

  const weekdays=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag"];
  const onetimeChild=document.getElementById("onetime-child");
  const baseChild=document.getElementById("base-child");
  const baseDay=document.getElementById("base-day");
  const deleteChild=document.getElementById("delete-child");
  const statusEl=document.getElementById("status");

  let allChildren=[];

  async function loadChildren(){
    allChildren=[];
    const snap=await db.ref("abholzeiten").once("value");
    const data=snap.val()||{};
    const names=new Set();
    for(const day in data){ for(const n in data[day]){ names.add(n); } }
    allChildren=Array.from(names).sort();

    renderSelects();
  }

  function renderSelects(){
    const opts=allChildren.map(n=>`<option>${n}</option>`).join("");
    onetimeChild.innerHTML=opts;
    baseChild.innerHTML=opts;
    deleteChild.innerHTML=opts;
    baseDay.innerHTML=weekdays.map(d=>`<option>${d}</option>`).join("");
  }

  async function saveOnetime(){
    const name=onetimeChild.value;
    const date=document.getElementById("onetime-date").value;
    const time=document.getElementById("onetime-time").value;
    if(!name||!date||!time){ statusEl.textContent="Bitte alles ausfüllen"; return; }
    await db.ref(`onetime/${date}/${name}`).set(time);
    statusEl.textContent="Einmalige Zeit gespeichert";
  }

  async function addChild(){
    const name=document.getElementById("new-child").value.trim();
    if(!name){ statusEl.textContent="Bitte Name eingeben"; return; }
    for(const day of weekdays){
      await db.ref(`abholzeiten/${day}/${name}`).set("");
    }
    allChildren.push(name);
    renderSelects();
    statusEl.textContent="Kind hinzugefügt";
  }

  async function saveBase(){
    const name=baseChild.value;
    const day=baseDay.value;
    const time=document.getElementById("base-time").value;
    if(!name||!day||!time){ statusEl.textContent="Bitte alles ausfüllen"; return; }
    await db.ref(`abholzeiten/${day}/${name}`).set(time);
    statusEl.textContent="Basiszeit gespeichert";
  }

  async function deleteChild(){
    const name=deleteChild.value;
    if(!name) return;
    for(const day of weekdays){
      await db.ref(`abholzeiten/${day}/${name}`).remove();
    }
    allChildren=allChildren.filter(n=>n!==name);
    renderSelects();
    statusEl.textContent="Kind gelöscht";
  }

  document.addEventListener("DOMContentLoaded", loadChildren);
</script>
</body>
</html>